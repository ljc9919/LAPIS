clear,clc
tic()
mutrue1 = [0.5753 	0.6469 	0.2637 	0.2909 	0.2947
0.0835 	0.1925 	0.5292 	0.3832 	0.5570];

mutrue = reshape(mutrue1,1,10);
datamu1 = mutrue1(1,:);   datamu2 = mutrue1(2,:);   

dataweight = [0.8542;0.1458];
AA = [0.062636523	0.035268413	0.017750241	0.007488863	0.017755036	-0.01831036	0.007933436	-0.010114649	0.0003308	0.021382654	0.00072178
0.035268413	0.070911203	0.017436728	0.02131064	0.01041257	-0.008965529	-0.013804679	-0.008727577	0.01899892	0.0211362	-0.012110786
0.017750241	0.017436728	0.028009638	0.01661794	0.011665093	-0.013832386	-0.000839844	0.008431981	0.022543881	0.00587899	-0.001228588
0.007488863	0.02131064	0.01661794	0.071296662	0.020754229	-0.004914055	-0.002583347	0.036782347	0.020962691	0.000157153	-0.016009538
0.017755036	0.01041257	0.011665093	0.020754229	0.037876671	0.004847719	-0.013239207	0.007289655	0.009264879	0.012330818	0.008651639
-0.01831036	-0.008965529	-0.013832386	-0.004914055	0.004847719	0.068081029	-0.011221841	0.003037433	-0.018461295	-0.00694787	0.008178809
0.007933436	-0.013804679	-0.000839844	-0.002583347	-0.013239207	-0.011221841	0.060962159	0.013293142	-0.033198274	0.004325317	-0.020841138
-0.010114649	-0.008727577	0.008431981	0.036782347	0.007289655	0.003037433	0.013293142	0.076429805	0.013349601	-0.009432804	-0.023256137
0.0003308	0.01899892	0.022543881	0.020962691	0.009264879	-0.018461295	-0.033198274	0.013349601	0.086719164	0.003961972	0.016717328
0.021382654	0.0211362	0.00587899	0.000157153	0.012330818	-0.00694787	0.004325317	-0.009432804	0.003961972	0.042048344	0.015332166
0.00072178	-0.012110786	-0.001228588	-0.016009538	0.008651639	0.008178809	-0.020841138	-0.023256137	0.016717328	0.015332166	0.065306986];
datasigma(:,:,1) = AA(1:5,1:5);

BB = [0.010967247	-0.004894772	0.002138819	0.015223986	0.002391137	0.002008166	-0.000408693	-0.005468252	0.018689046	-0.000307172	0.004372526
-0.004894772	0.070710656	-0.009572528	0.024589391	-0.018734515	-0.009672952	-0.019629294	-0.00595519	0.016653448	-0.018014182	0.004994881
0.002138819	-0.009572528	0.065262	0.013008591	0.030673178	0.013983507	0.00861751	0.018040665	0.013097093	0.010714291	0.021340542
0.015223986	0.024589391	0.013008591	0.092888584	0.011566824	-0.009728317	-0.00328945	0.011391548	0.048971511	-0.00771201	0.020949664
0.002391137	-0.018734515	0.030673178	0.011566824	0.073891725	-0.015772448	-0.020395463	-0.003006298	0.031645788	0.022090711	0.017805981
0.002008166	-0.009672952	0.013983507	-0.009728317	-0.015772448	0.055096769	-0.005637023	0.021501138	-0.012816611	0.003749498	0.00506068
-0.000408693	-0.019629294	0.00861751	-0.00328945	-0.020395463	-0.005637023	0.100401102	0.010056471	-0.015440473	0.026985692	-0.00359275
-0.005468252	-0.00595519	0.018040665	0.011391548	-0.003006298	0.021501138	0.010056471	0.080628025	-0.013578924	-0.003152401	-0.005138551
0.018689046	0.016653448	0.013097093	0.048971511	0.031645788	-0.012816611	-0.015440473	-0.013578924	0.111945788	0.015789102	-0.006853197
-0.000307172	-0.018014182	0.010714291	-0.00771201	0.022090711	0.003749498	0.026985692	-0.003152401	0.015789102	0.060624394	0.011236764
0.004372526	0.004994881	0.021340542	0.020949664	0.017805981	0.00506068	-0.00359275	-0.005138551	-0.006853197	0.011236764	0.104162963];
datasigma(:,:,2) = BB(1:5,1:5);

N = 5;

IM=sign([0	0.604328586	0	0	0	0.218094675	0.335669628	0	0	0	0
0.604328586	0	-0.448255943	0	0	0.320282934	0.505490034	0	-0.401133123	0	0
0	-0.448255943	0	0.16837281	0.553556606	0	0	-0.532746333	0	0.748115209	0
0	0	0.16837281	0	0.335283464	0	0.337270073	0	-0.509976426	0	0
0	0	0.553556606	0.335283464	0	0	0	-0.581706519	0	0.805509325	0
0.218094675	0.320282934	0	0	0	0	0.492959914	0.596376723	-0.45860916	0	0
0	0	0	0.337270073	0	0.492959914	0	0	-0.488976146	0	0
0	0	-0.532746333	0	-0.581706519	0.596376723	0	0	0	-0.5090657	0
0	0	0	-0.509976426	0	-0.45860916	0	0	0	0	0
0	0	0.748115209	0	0.805509325	0	0	-0.5090657	0	0	0
0	0	0	0	0	0	0	0	0.567017303	0	0]);
IM=IM(1:5,1:5);

Hilln = 4*ones(N,N);

AB1 = [0	0.604328586	0	0	0	0.218094675	0.335669628	0	0	0	0
0.604328586	0	-0.448255943	0	0	0.320282934	0.505490034	0	-0.401133123	0	0
0	-0.448255943	0	0.16837281	0.553556606	0	0	-0.532746333	0	0.748115209	0
0	0	0.16837281	0	0.335283464	0	0.337270073	0	-0.509976426	0	0
0	0	0.553556606	0.335283464	0	0	0	-0.581706519	0	0.805509325	0
0.218094675	0.320282934	0	0	0	0	0.492959914	0.596376723	-0.45860916	0	0
0	0	0	0.337270073	0	0.492959914	0	0	-0.488976146	0	0
0	0	-0.532746333	0	-0.581706519	0.596376723	0	0	0	-0.5090657	0
0	0	0	-0.509976426	0	-0.45860916	0	0	0	0	0
0	0	0.748115209	0	0.805509325	0	0	-0.5090657	0	0	0
0	0	0	0	0	0	0	0	0.567017303	0	0];
AB1 = AB1(1:5,1:5);

AB = AB1; AB(find(AB1<0)) = -AB(find(AB1<0));

cno = (AB1(:)>0);
C = zeros(N,N);
C(cno) = AB1(cno);

dno = (AB1(:)<0);
D = zeros(N,N);
D(dno) = -AB1(dno);

k = 1*ones(N,1);
wemax = 1*ones(1,N);
lambda_penalty = 30;

cycle_index = 500;
no = 1;
dd = 0.0144; 

for ii = 7
    for jj = 9
        for kk = 7
            for ss= 6:8
                for hh=6:7            
                    for pp=3
                        for ll=5:6
                            for mm=4:5
                                for nn=4
                                    for vv=2:3
                                        for tt=2:1:5
                                            for ww=2:1:3
                                                G = [0.1*ii;0.1*jj;0.1*kk;0.1*ss;0.1*hh];
                                                g = [0.1*pp-0.05;0.1*ll-0.05;0.1*mm-0.05;0.1*nn-0.05;0.1*vv-0.05];
                                                S = [0.1*tt*ones(2,5);0.1*ww*ones(3,5)];

                                                [xx,n,sigma]=Solver5(cycle_index,k,G,g,S,IM,Hilln,AB,C,D,dd,wemax);

                                                N = 5;
                                                index=size(n,1);  %% The number of the stable states
                                                alpha=zeros(index,1);  %% The weight of the stable states
                                                mu=zeros(index,N);  %% The mean value of the Gaussian density function
                                                for i=1:index
                                                %The mean value of each stable state
                                                    mu(i,:)=xx(n(i,1),:); 
                                                    sigma0{i}=reshape(sigma(:,:,i),N,N)';
                                                %The weight of each stable state
                                                    alpha(i)=n(i,2)/sum(n(:,2));   %%%%%??a??alpha??????muo?lpha????????
                                                end
                                                if size(mu,1)==2
                                                    wei_dist = (alpha-dataweight).^2;

                                                    loss(ii,jj,kk,ss,hh,pp,ll,mm,nn,vv,tt,ww) = dataweight(1)*1/2*((mu(1,:)-datamu1)*(datasigma(:,:,1)\(mu(1,:)-datamu1)')-log(det(datasigma(:,:,1)\sigma(:,:,1)))+trace(datasigma(:,:,1)\sigma(:,:,1))-N)...
                                                          +dataweight(2)*1/2*((mu(2,:)-datamu2)*(datasigma(:,:,2)\(mu(2,:)-datamu2)')-log(det(datasigma(:,:,2)\sigma(:,:,2)))+trace(datasigma(:,:,2)\sigma(:,:,2))-N)...
                                                          +1/2*lambda_penalty*sum(wei_dist);

                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

A=loss(7:end,9:end,7:end,6:end,6:end,1:end,1:end,1:end,1:end,1:end,1:end,1:end);
[minValue, linearIndex] = min(nonzeros(A(:));
min(nonzeros(A));
[index1, index2, index3, index4,index5,index6,index7,index8,index9,index10,index11,index12] = ind2sub(size(A), linearIndex);
    save first_screening_ND.mat